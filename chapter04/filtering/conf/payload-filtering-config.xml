<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.0"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xmlns:context="http://www.springframework.org/schema/context"
      xmlns:jms="http://www.mulesource.org/schema/mule/jms/2.0"
      xmlns:xm="http://www.mulesource.org/schema/mule/xml/2.0"
      xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.0"
      xmlns:stdio="http://www.mulesource.org/schema/mule/stdio/2.0"
      xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
       http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
       http://www.mulesource.org/schema/mule/jms/2.0 http://www.mulesource.org/schema/mule/jms/2.0/mule-jms.xsd
       http://www.mulesource.org/schema/mule/xml/2.0 http://www.mulesource.org/schema/mule/xml/2.0/mule-xml.xsd
       http://www.mulesource.org/schema/mule/vm/2.0 http://www.mulesource.org/schema/mule/vm/2.0/mule-vm.xsd
       http://www.mulesource.org/schema/mule/stdio/2.0 http://www.mulesource.org/schema/mule/stdio/2.0/mule-stdio.xsd
       "
>

<jms:activemq-connector name="jmsConnector" specification="1.1" brokerURL="vm://localhost" />

<model name="payloadFilteringModel">
    <service name="payloadFilteringService">
        <inbound> 
            <forwarding-catch-all-strategy> 
                <jms:outbound-endpoint queue="errors"/> 
            </forwarding-catch-all-strategy> 

            <jms:inbound-endpoint queue="messages"/> 
            <vm:inbound-endpoint  address="vm://messages"/>

            <selective-consumer-router>
                <payload-type-filter expectedType="com.muleinaction.common.Order"/>  
            </selective-consumer-router> 
      </inbound>
      <bridge-component/> 
      <outbound>
          <outbound-pass-through-router> 
              <stdio:outbound-endpoint system="OUT"/>
          </outbound-pass-through-router> 
       </outbound>
    </service>

    <!-- Uncomment the below to see messages going to the error channel from the
         forwarding-catch-all-strategy -->

    <!--
    <service name="Error Channel">
        <inbound>
            <jms:inbound-endpoint queue="errors"/>
        </inbound>
        <outbound>
          <outbound-pass-through-router> 
              <stdio:outbound-endpoint system="OUT"/>
          </outbound-pass-through-router> 
       </outbound>
    </service>
    -->
</model>

</mule>
