<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:spring="http://www.springframework.org/schema/beans" xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.1"
	xsi:schemaLocation="
       http://www.mulesource.org/schema/mule/core/2.1 http://www.mulesource.org/schema/mule/core/2.1/mule.xsd
       http://www.mulesource.org/schema/mule/vm/2.1 http://www.mulesource.org/schema/mule/vm/2.1/mule-vm.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

	<spring:bean id="SpringBeanLifecycleTracker" class="com.muleinaction.lifecycle.LifecycleTrackerComponent"
		init-method="springInitialize" destroy-method="springDestroy" scope="singleton">
		<spring:property name="property" value="foo" />
	</spring:bean>

	<spring:bean id="SpringBeanLifecycleTrackerComponent" class="com.muleinaction.lifecycle.LifecycleTrackerComponent"
		init-method="springInitialize" destroy-method="springDestroy" scope="singleton">
		<spring:property name="property" value="bar" />
	</spring:bean>

	<custom-transformer name="LifecycleTrackerTransformer"
		class="com.muleinaction.lifecycle.LifecycleTrackerTransformer">
		<spring:property name="property" value="boo" />
	</custom-transformer>

	<model name="MuleLifecyle">

		<service name="SpringBeanService">
			<inbound>
				<vm:inbound-endpoint path="SpringBeanService.In" />
			</inbound>
			<component>
				<spring-object bean="SpringBeanLifecycleTrackerComponent" />
			</component>
		</service>
		
		<service name="MulePrototypeService">
			<inbound>
				<vm:inbound-endpoint path="MulePrototypeService.In" />
			</inbound>
			<component>
				<prototype-object class="com.muleinaction.lifecycle.LifecycleTrackerComponent">
					<property key="property" value="baz" />
				</prototype-object>
			</component>
		</service>
		
		<service name="MuleSingletonService">
			<inbound>
				<vm:inbound-endpoint path="MuleSingletonService.In" />
			</inbound>
			<component>
				<singleton-object class="com.muleinaction.lifecycle.LifecycleTrackerComponent">
					<property key="property" value="baz" />
				</singleton-object>
			</component>
		</service>

		<service name="EchoService">
			<inbound>
				<vm:inbound-endpoint path="EchoService.In" synchronous="true"
					transformer-refs="LifecycleTrackerTransformer" />
			</inbound>
			<echo-component />
		</service>

	</model>
</mule>
