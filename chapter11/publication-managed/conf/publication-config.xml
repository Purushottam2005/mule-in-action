<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.1"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:http="http://www.mulesource.org/schema/mule/http/2.1"
		xmlns:jms="http://www.mulesource.org/schema/mule/jms/2.1"
		xmlns:xm="http://www.mulesource.org/schema/mule/xml/2.1"
		xmlns:spring="http://www.springframework.org/schema/beans"
		xmlns:context="http://www.springframework.org/schema/context"
		xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
					http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
					http://www.mulesource.org/schema/mule/core/2.1 http://www.mulesource.org/schema/mule/core/2.1/mule.xsd
					http://www.mulesource.org/schema/mule/jms/2.1 http://www.mulesource.org/schema/mule/jms/2.1/mule-jms.xsd
					http://www.mulesource.org/schema/mule/http/2.1 http://www.mulesource.org/schema/mule/http/2.1/mule-http.xsd
					http://www.mulesource.org/schema/mule/xml/2.1 http://www.mulesource.org/schema/mule/xml/2.1/mule-xml.xsd">
	
	<context:property-placeholder location="publication.properties" />

	<spring:beans>
		<spring:import resource="management-config.xml"/>
		<spring:import resource="publication-jms-config.xml"/>
	</spring:beans>
	
	<object-to-byte-array-transformer name="ObjectToByteArray" />
	<object-to-string-transformer name="ObjectToString" />
	
	<xm:xslt-transformer name="DocbookToFO"	xsl-file="docbook-fo.xsl" />
	
	<model name="publicationModel">
		<service name="publicationService">
			<inbound>
				<http:inbound-endpoint address="http://${esb.bind.address}:${esb.web.port}/publicationService">
					<transformer ref="ObjectToByteArray" />
					<transformer ref="DocbookToFO" />
					<transformer ref="ObjectToString" />
				</http:inbound-endpoint>															
			</inbound>
			<outbound>
				<pass-through-router>
					<jms:outbound-endpoint queue="publicationQueue"
							connector-ref="publicationJmsConnector" />
				</pass-through-router>
			</outbound>
		</service>
	</model>
</mule>
